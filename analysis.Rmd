---
title: "analysis"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


```{r}
library(tidyverse)
library(ggmap)
library(janitor)
```

# crime number

```{r}
MD_Crime %>%
  group_by(`Crime Name2`) %>%
  count() %>%
  arrange(desc(n)) %>%
  as.data.frame()

MD_Crime %>%
  group_by(`Crime Name1`) %>%
  count() %>%
  arrange(n) 

MD_Crime3 <- MD_Crime %>%
  group_by(`Crime Name2`) %>%
  summarise(count = n()) %>%
  filter(count > 1000) 

MD_Crime %>%
  filter(`Crime Name1` == "Crime Against Person")

MD_Crime %>%
  filter(`Crime Name2` == "Larceny" | `Crime Name2` == "Damage Property" | `Crime Name2` ==  "Assault" | `Crime Name2` == "Drugs"| `Crime Name2` ==  "Fraud") 
  
unique(MD_Crime$`Crime Name2`)

https://stringr.tidyverse.org/reference/str_trim.html
clean_names()
```

# crime rate by city

```{r}
MD_Crime %>%
  group_by(City)%>%
  count() %>%
  arrange(desc(n))
10615/30587 = 0.3470429
4501/30587 = 0.147154

```

# Location
```{r}
MD_Crime %>%
  filter(Latitude != 0) %>%
  ggplot(mapping = aes(x = Latitude, y = Longitude)) +
  geom_hex() +
  scale_fill_distiller(palette = "RdYlBu") +
  ggtitle("Location And Density of Crimes in Maryland in 2020")

library(maps)

us_states <- map_data("state") %>%
  filter(region == "maryland") %>%
  rename(Longitude = long,
         Latitude = lat)
ggplot(data = us_states,
            mapping = aes(x = long, y = lat, group = group)) +
   geom_polygon(fill = "white", color = "black")


MD_Crime4 <- MD_Crime %>%
  filter(`Crime Name2` == "Larceny" | `Crime Name2` == "Damage Property" | `Crime Name2` ==  "Assault" | `Crime Name2` == "Drugs"| `Crime Name2` ==  "Fraud") %>%
  filter(Longitude != 0) %>%
  group_by(`Crime Name2`)
  
# Create breaks for the color scale
mybreaks <- c(0.02, 0.04, 0.08, 1, 7)

# Reorder data to show biggest cities on top
data <- MD_Crime3 %>%
  arrange(count) #%>%
  mutate(name=factor(`Crime Name2`, unique(`Crime Name2`))) #%>%
  mutate(pop=pop/1000000) 

# Build the map

library(ggforce)
ggplot(data = us_states, mapping = aes(x = Longitude, y = Latitude)) +
    geom_polygon(fill = "white", color = "black") +
    facet_zoom(xlim = c(-76.90530, -77.51680),
               ylim = c(38.93900, 39.34210)) +
    geom_point(data = MD_Crime4, mapping = aes(x=Longitude, y=Latitude, color = `Crime Name2`)) 


  
  #+
    scale_size_continuous(name="Population (in M)", trans="log", range=c(1,12), breaks=mybreaks) +
    scale_alpha_continuous(name="Population (in M)", trans="log", range=c(0.1, .9), breaks=mybreaks) +
    scale_color_viridis(option="magma", trans="log", breaks=mybreaks, name="Population (in M)" ) +
    theme_void() + ylim(50,59) + coord_map() + 
    guides( colour = guide_legend()) +
    ggtitle("The 1000 biggest cities in the UK") +
    theme(
      legend.position = c(0.85, 0.8),
      text = element_text(color = "#22211d"),
      plot.background = element_rect(fill = "#f5f5f2", color = NA), 
      panel.background = element_rect(fill = "#f5f5f2", color = NA), 
      legend.background = element_rect(fill = "#f5f5f2", color = NA),
      plot.title = element_text(size= 16, hjust=0.1, color = "#4e4d47", margin = margin(b = -0.1, t = 0.4, l = 2, unit = "cm")),
    )

```
# Date and Time
```{r}
MD_Crime %>%
  mutate(Date = `Dispatch Date` == `Start Date`) %>%
  group_by(Date) %>%
  count() %>%
  mutate(prop = n/sum(n))

MD_Crime %>%
  mutate(Date = `Dispatch Date` == `Start Date`) %>%
  mutate(Date = case_when(Date = TRUE ~ "Same Date",
                          Date = FALSE ~ "Different Date")) %>%
  group_by(Date) %>%
  summarise(count = n()) %>%
  mutate(proportion = count / sum(count)) 
# all on the same date

MD_Crime %>%
  mutate(Date = `Dispatch Date` == `Start Date`) %>%
  filter(Date == TRUE) %>%
  mutate(Dispatch = case_when(`Start Time` < `Dispatch Time` ~ "After",
                           `Start Time` > `Dispatch Time` ~ "Before",
                           `Start Time` == `Dispatch Time` ~ "On Time")) %>%
  group_by(Dispatch)  %>%
  summarise(count = n()) %>%
  mutate(proportion = count / sum(count)) 
```

